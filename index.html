<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Math-education website redesigns — browse, search, and filter all projects.">
  <title>Math Redesigns — Project Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy:  { 950:'#080F1F', 900:'#0C1D3A', 800:'#132B50', 700:'#1E3A5F', 600:'#2B4C7E', 500:'#3A6298' },
            gold:  { 500:'#D4A017', 400:'#E8B931', 300:'#F0CC5B' },
            slate: { 750:'#293548' },
          },
          fontFamily: { sans:['Inter','system-ui','-apple-system','sans-serif'] },
        },
      },
    };
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    [x-cloak]{display:none!important}
    .filter-chip{display:inline-flex;align-items:center;gap:0.375rem;padding:0.375rem 0.75rem;border-radius:9999px;font-size:0.75rem;line-height:1rem;font-weight:500;border-width:1px;transition:all 150ms;cursor:pointer;user-select:none}
    .filter-chip--off{background:transparent;border-color:rgb(51 65 85);color:rgb(148 163 184)}
    .filter-chip--off:hover{border-color:rgb(100 116 139);color:rgb(203 213 225)}
    .filter-chip--on{background:rgba(212,160,23,.15);border-color:rgba(212,160,23,.5);color:#E8B931}

    /* Custom scrollbar for filter panel */
    .filter-scroll::-webkit-scrollbar{width:4px}
    .filter-scroll::-webkit-scrollbar-track{background:transparent}
    .filter-scroll::-webkit-scrollbar-thumb{background:#334155;border-radius:2px}
  </style>
</head>
<body class="font-sans bg-navy-950 text-slate-300 antialiased min-h-screen flex flex-col">

  <!-- ========== HEADER ========== -->
  <header class="bg-navy-900/80 backdrop-blur-lg border-b border-white/5 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <a href="index.html" class="flex items-center gap-3 group">
        <div class="w-9 h-9 bg-gold-500 rounded-lg flex items-center justify-center shadow group-hover:bg-gold-400 transition-colors">
          <svg class="w-5 h-5 text-navy-900" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.745 3A23.933 23.933 0 0 0 3 12c0 3.183.62 6.22 1.745 9M19.255 3C20.38 5.78 21 8.817 21 12s-.62 6.22-1.745 9m-13.51-9h12.51m-6.255-9v18"/></svg>
        </div>
        <span class="text-white font-bold text-lg tracking-tight hidden sm:inline">Math&nbsp;Redesigns</span>
      </a>

      <div class="flex items-center gap-3">
        <span id="site-count" class="text-xs text-slate-500 tabular-nums hidden sm:inline"></span>
        <a href="https://github.com/CMath-ProClub/Math" target="_blank" rel="noopener"
           class="p-2 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-colors" aria-label="GitHub repository">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.11.82-.26.82-.58l-.01-2.04c-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.09-.75.08-.73.08-.73 1.21.08 1.85 1.24 1.85 1.24 1.07 1.84 2.81 1.31 3.5 1 .11-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.29-1.23 3.29-1.23.66 1.66.25 2.88.12 3.18a4.65 4.65 0 0 1 1.24 3.22c0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22l-.01 3.29c0 .32.21.7.82.58A12 12 0 0 0 12 .3"/></svg>
        </a>
      </div>
    </div>
  </header>

  <!-- ========== HERO / SEARCH ========== -->
  <section class="bg-gradient-to-b from-navy-900 to-navy-950 border-b border-white/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-14">
      <h1 class="text-2xl sm:text-3xl font-extrabold text-white tracking-tight">Project Hub</h1>
      <p class="mt-2 text-slate-400 text-sm sm:text-base max-w-xl">Browse every math-education website redesign. Search by name, filter by tag, or sort by any metric.</p>

      <!-- Search -->
      <div class="mt-6 relative max-w-xl">
        <svg class="absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-500 pointer-events-none" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/></svg>
        <input id="search" type="text" placeholder="Search sites…"
               class="w-full pl-11 pr-4 py-3 bg-navy-800 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-gold-500/40 focus:border-gold-500/40 transition-all">
        <kbd class="absolute right-3.5 top-1/2 -translate-y-1/2 hidden sm:inline-flex items-center px-1.5 py-0.5 bg-navy-700 border border-white/10 rounded text-[10px] text-slate-500 font-mono">/</kbd>
      </div>
    </div>
  </section>

  <!-- ========== TOOLBAR (Filters + Sort) ========== -->
  <section class="bg-navy-950 border-b border-white/5 sticky top-16 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex flex-col sm:flex-row sm:items-center gap-3">

        <!-- Filter toggle -->
        <button id="filter-toggle" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-medium text-slate-400 bg-navy-800 border border-white/10 hover:border-white/20 hover:text-slate-200 transition-all">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"/></svg>
          Filters
          <span id="active-filter-count" class="hidden ml-1 px-1.5 py-0.5 bg-gold-500 text-navy-900 rounded-full text-[10px] font-bold leading-none"></span>
        </button>

        <!-- Active filter chips (rendered by JS) -->
        <div id="active-chips" class="flex flex-wrap gap-1.5 flex-1 min-h-[28px]"></div>

        <!-- Sort -->
        <div class="flex items-center gap-2 sm:ml-auto flex-shrink-0">
          <label for="sort-select" class="text-xs text-slate-500">Sort</label>
          <select id="sort-select"
                  class="bg-navy-800 border border-white/10 rounded-lg text-xs text-slate-300 px-2.5 py-2 focus:outline-none focus:ring-2 focus:ring-gold-500/40 cursor-pointer">
            <option value="name-asc">Name A → Z</option>
            <option value="name-desc">Name Z → A</option>
            <option value="updated-desc" selected>Recently Updated</option>
            <option value="created-desc">Newest First</option>
            <option value="created-asc">Oldest First</option>
            <option value="pages-desc">Most Pages</option>
            <option value="pages-asc">Fewest Pages</option>
            <option value="complexity-desc">Complexity ↓</option>
            <option value="complexity-asc">Complexity ↑</option>
          </select>
        </div>
      </div>
    </div>
  </section>

  <!-- ========== FILTER PANEL (collapsible) ========== -->
  <div id="filter-panel" class="hidden bg-navy-900/60 border-b border-white/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Tags -->
        <div>
          <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2.5">Tags</h3>
          <div id="tag-filters" class="flex flex-wrap gap-1.5 filter-scroll max-h-48 overflow-y-auto"></div>
        </div>
        <!-- Complexity -->
        <div>
          <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2.5">Complexity</h3>
          <div id="complexity-filters" class="flex flex-wrap gap-1.5"></div>
        </div>
        <!-- Status -->
        <div>
          <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2.5">Status</h3>
          <div id="status-filters" class="flex flex-wrap gap-1.5"></div>
        </div>
        <!-- Org Type -->
        <div>
          <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2.5">Org Type</h3>
          <div id="orgtype-filters" class="flex flex-wrap gap-1.5"></div>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-3">
        <button id="clear-filters" class="text-xs text-slate-500 hover:text-gold-400 transition-colors">Clear all filters</button>
      </div>
    </div>
  </div>

  <!-- ========== SITE GRID ========== -->
  <main class="flex-1">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Results info -->
      <p id="results-info" class="text-xs text-slate-500 mb-5"></p>

      <!-- Grid -->
      <div id="site-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
        <!-- Cards rendered by JS -->
      </div>

      <!-- Empty state -->
      <div id="empty-state" class="hidden text-center py-20">
        <svg class="w-12 h-12 text-slate-700 mx-auto mb-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/></svg>
        <p class="text-slate-500 font-medium">No sites match your filters</p>
        <p class="text-slate-600 text-sm mt-1">Try adjusting your search or removing some filters.</p>
        <button id="empty-clear" class="mt-4 text-sm text-gold-400 hover:text-gold-300 font-medium transition-colors">Clear all filters</button>
      </div>

      <!-- Loading state -->
      <div id="loading-state" class="text-center py-20">
        <div class="w-8 h-8 border-2 border-slate-700 border-t-gold-500 rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-slate-500 text-sm">Loading sites…</p>
      </div>
    </div>
  </main>

  <!-- ========== FOOTER ========== -->
  <footer class="bg-navy-900/40 border-t border-white/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col sm:flex-row justify-between items-center gap-3">
      <p class="text-xs text-slate-600">&copy; 2026 Carter Matherne. All rights reserved.</p>
      <div class="flex items-center gap-4">
        <a href="https://github.com/CMath-ProClub/Math" target="_blank" rel="noopener" class="text-xs text-slate-600 hover:text-slate-400 transition-colors">GitHub</a>
        <span class="text-slate-800">·</span>
        <a href="shared/taxonomy.json" target="_blank" class="text-xs text-slate-600 hover:text-slate-400 transition-colors">Taxonomy</a>
        <span class="text-slate-800">·</span>
        <a href="sites/manifest.json" target="_blank" class="text-xs text-slate-600 hover:text-slate-400 transition-colors">Manifest</a>
      </div>
    </div>
  </footer>

  <!-- ========== APPLICATION LOGIC ========== -->
  <script>
  (function () {
    'use strict';

    /* ---- State ---- */
    let allSites     = [];
    let taxonomy     = null;
    let searchQuery  = '';
    let activeTags   = new Set();
    let activeComplexity = new Set();
    let activeStatus = new Set();
    let activeOrgType = new Set();
    let sortKey      = 'updated-desc';

    const complexityOrder = { simple:1, moderate:2, complex:3, enterprise:4 };

    /* ---- DOM refs ---- */
    const $search       = document.getElementById('search');
    const $grid         = document.getElementById('site-grid');
    const $empty        = document.getElementById('empty-state');
    const $loading      = document.getElementById('loading-state');
    const $resultsInfo  = document.getElementById('results-info');
    const $siteCount    = document.getElementById('site-count');
    const $sortSelect   = document.getElementById('sort-select');
    const $filterToggle = document.getElementById('filter-toggle');
    const $filterPanel  = document.getElementById('filter-panel');
    const $activeChips  = document.getElementById('active-chips');
    const $activeCount  = document.getElementById('active-filter-count');
    const $clearFilters = document.getElementById('clear-filters');
    const $emptyClear   = document.getElementById('empty-clear');

    /* ---- Boot ---- */
    async function init() {
      try {
        const [manifestRes, taxonomyRes] = await Promise.all([
          fetch('sites/manifest.json'),
          fetch('shared/taxonomy.json'),
        ]);
        const manifest = await manifestRes.json();
        taxonomy = await taxonomyRes.json();
        allSites = manifest.sites || [];
        $siteCount.textContent = allSites.length + ' site' + (allSites.length !== 1 ? 's' : '');
        buildFilterUI();
        render();
      } catch (e) {
        console.error('Failed to load data', e);
        $loading.innerHTML = '<p class="text-red-400 text-sm">Failed to load site data. Make sure manifest.json exists.</p>';
      }
    }

    /* ---- Build filter chips from taxonomy ---- */
    function buildFilterUI() {
      if (!taxonomy) return;

      // Collect all tags actually in use
      const usedTags = new Set();
      allSites.forEach(s => (s.tags || []).forEach(t => usedTags.add(t)));

      // Tags
      const tagContainer = document.getElementById('tag-filters');
      const allTagValues = [];
      Object.values(taxonomy.tags).forEach(group => {
        group.values.forEach(v => allTagValues.push(v));
      });
      allTagValues.forEach(tag => {
        const inUse = usedTags.has(tag);
        tagContainer.appendChild(makeChip(tag, 'tag', inUse));
      });

      // Complexity
      const compContainer = document.getElementById('complexity-filters');
      Object.keys(taxonomy.complexity.levels).forEach(key => {
        const label = taxonomy.complexity.levels[key].label;
        compContainer.appendChild(makeChip(label, 'complexity', true, key));
      });

      // Status
      const statusContainer = document.getElementById('status-filters');
      taxonomy.statuses.values.forEach(s => {
        statusContainer.appendChild(makeChip(capitalize(s), 'status', true, s));
      });

      // Org type
      const orgContainer = document.getElementById('orgtype-filters');
      taxonomy.organizationTypes.values.forEach(o => {
        orgContainer.appendChild(makeChip(formatOrgType(o), 'orgtype', true, o));
      });
    }

    function makeChip(label, group, enabled, value) {
      const el = document.createElement('button');
      el.type = 'button';
      el.textContent = label;
      el.dataset.group = group;
      el.dataset.value = value || label;
      el.className = 'filter-chip filter-chip--off' + (enabled ? '' : ' opacity-40');
      el.addEventListener('click', () => toggleFilter(group, el.dataset.value, el));
      return el;
    }

    function toggleFilter(group, value, el) {
      const set = getSet(group);
      if (set.has(value)) { set.delete(value); el.className = 'filter-chip filter-chip--off'; }
      else { set.add(value); el.className = 'filter-chip filter-chip--on'; }
      render();
    }

    function getSet(group) {
      if (group === 'tag') return activeTags;
      if (group === 'complexity') return activeComplexity;
      if (group === 'status') return activeStatus;
      if (group === 'orgtype') return activeOrgType;
      return new Set();
    }

    /* ---- Render ---- */
    function render() {
      $loading.classList.add('hidden');

      const filtered = filterSites();
      const sorted   = sortSites(filtered);

      // Results info
      const total = allSites.length;
      const shown = sorted.length;
      $resultsInfo.textContent = shown === total
        ? `Showing all ${total} site${total !== 1 ? 's' : ''}`
        : `Showing ${shown} of ${total} site${total !== 1 ? 's' : ''}`;

      // Grid
      $grid.innerHTML = '';
      sorted.forEach(site => $grid.appendChild(buildCard(site)));

      // Empty state
      $empty.classList.toggle('hidden', sorted.length > 0);
      $grid.classList.toggle('hidden', sorted.length === 0);

      // Active chips
      renderActiveChips();
    }

    /* ---- Filter ---- */
    function filterSites() {
      return allSites.filter(site => {
        // Search
        if (searchQuery) {
          const q = searchQuery.toLowerCase();
          const hay = [
            site.name, site.slug, site.organization?.name,
            site.portfolio?.shortDescription,
            ...(site.tags || []),
          ].filter(Boolean).join(' ').toLowerCase();
          if (!hay.includes(q)) return false;
        }
        // Tags (AND logic — site must have ALL selected tags)
        if (activeTags.size > 0) {
          const siteTags = new Set(site.tags || []);
          for (const t of activeTags) { if (!siteTags.has(t)) return false; }
        }
        // Complexity
        if (activeComplexity.size > 0 && !activeComplexity.has(site.complexity)) return false;
        // Status
        if (activeStatus.size > 0 && !activeStatus.has(site.status)) return false;
        // Org type
        if (activeOrgType.size > 0 && !activeOrgType.has(site.organization?.type)) return false;

        return true;
      });
    }

    /* ---- Sort ---- */
    function sortSites(sites) {
      const s = [...sites];
      switch (sortKey) {
        case 'name-asc':       return s.sort((a,b) => a.name.localeCompare(b.name));
        case 'name-desc':      return s.sort((a,b) => b.name.localeCompare(a.name));
        case 'updated-desc':   return s.sort((a,b) => b.updated.localeCompare(a.updated));
        case 'created-desc':   return s.sort((a,b) => b.created.localeCompare(a.created));
        case 'created-asc':    return s.sort((a,b) => a.created.localeCompare(b.created));
        case 'pages-desc':     return s.sort((a,b) => (b.scope?.pageCount||0) - (a.scope?.pageCount||0));
        case 'pages-asc':      return s.sort((a,b) => (a.scope?.pageCount||0) - (b.scope?.pageCount||0));
        case 'complexity-desc':return s.sort((a,b) => (complexityOrder[b.complexity]||0) - (complexityOrder[a.complexity]||0));
        case 'complexity-asc': return s.sort((a,b) => (complexityOrder[a.complexity]||0) - (complexityOrder[b.complexity]||0));
        default: return s;
      }
    }

    /* ---- Card builder ---- */
    function buildCard(site) {
      const card = document.createElement('a');
      card.href = `sites/${site.slug}/index.html`;
      card.className = 'group block bg-navy-900/60 border border-white/5 rounded-2xl p-6 hover:border-gold-500/30 hover:bg-navy-900 transition-all duration-200';

      const statusColors = {
        complete:'bg-emerald-500/15 text-emerald-400 border-emerald-500/20',
        'in-progress':'bg-blue-500/15 text-blue-400 border-blue-500/20',
        review:'bg-amber-500/15 text-amber-400 border-amber-500/20',
        prospect:'bg-slate-500/15 text-slate-400 border-slate-500/20',
        deployed:'bg-purple-500/15 text-purple-400 border-purple-500/20',
        paused:'bg-orange-500/15 text-orange-400 border-orange-500/20',
        archived:'bg-slate-500/15 text-slate-500 border-slate-500/20',
      };
      const statusClass = statusColors[site.status] || statusColors.prospect;

      card.innerHTML = `
        <div class="flex items-start justify-between gap-3 mb-4">
          <div class="min-w-0">
            <h2 class="text-white font-bold text-base truncate group-hover:text-gold-400 transition-colors">${esc(site.name)}</h2>
            <p class="text-slate-500 text-xs mt-0.5 font-mono">${esc(site.slug)}</p>
          </div>
          <span class="flex-shrink-0 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold border ${statusClass}">
            ${capitalize(esc(site.status))}
          </span>
        </div>

        <p class="text-slate-400 text-sm leading-relaxed line-clamp-2 mb-4">${esc(site.portfolio?.shortDescription || '')}</p>

        <div class="flex flex-wrap gap-1.5 mb-4">
          ${(site.tags || []).map(t => `<span class="px-2 py-0.5 bg-white/5 border border-white/5 rounded-md text-[10px] font-medium text-slate-400">${esc(t)}</span>`).join('')}
        </div>

        <div class="grid grid-cols-3 gap-3 pt-4 border-t border-white/5">
          <div>
            <p class="text-[10px] text-slate-600 uppercase tracking-wider">Pages</p>
            <p class="text-sm font-semibold text-slate-300 mt-0.5">${site.scope?.pageCount || '—'}</p>
          </div>
          <div>
            <p class="text-[10px] text-slate-600 uppercase tracking-wider">Complexity</p>
            <p class="text-sm font-semibold text-slate-300 mt-0.5">${capitalize(esc(site.complexity || '—'))}</p>
          </div>
          <div>
            <p class="text-[10px] text-slate-600 uppercase tracking-wider">Org</p>
            <p class="text-sm font-semibold text-slate-300 mt-0.5">${formatOrgType(site.organization?.type || '—')}</p>
          </div>
        </div>

        ${site.audience?.reach ? `
        <div class="mt-3 pt-3 border-t border-white/5 flex items-center gap-2">
          <svg class="w-3.5 h-3.5 text-slate-600 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"/></svg>
          <span class="text-xs text-slate-500">${esc(site.audience.reach)}</span>
        </div>` : ''}

        <div class="mt-4 flex items-center justify-between">
          <span class="text-xs text-slate-600">Updated ${formatDate(site.updated)}</span>
          <span class="text-xs font-medium text-gold-500 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1">
            View site <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"/></svg>
          </span>
        </div>
      `;

      return card;
    }

    /* ---- Active filter chips in toolbar ---- */
    function renderActiveChips() {
      $activeChips.innerHTML = '';
      let count = 0;

      const addChip = (label, group, value) => {
        count++;
        const el = document.createElement('button');
        el.type = 'button';
        el.className = 'inline-flex items-center gap-1 px-2 py-1 bg-gold-500/10 border border-gold-500/20 rounded-full text-[10px] font-medium text-gold-400 hover:bg-gold-500/20 transition-colors';
        el.innerHTML = `${esc(label)} <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg>`;
        el.addEventListener('click', () => {
          getSet(group).delete(value);
          // Also un-highlight the chip in the filter panel
          document.querySelectorAll(`[data-group="${group}"][data-value="${value}"]`).forEach(c => {
            c.className = 'filter-chip filter-chip--off';
          });
          render();
        });
        $activeChips.appendChild(el);
      };

      activeTags.forEach(v => addChip(v, 'tag', v));
      activeComplexity.forEach(v => addChip(capitalize(v), 'complexity', v));
      activeStatus.forEach(v => addChip(capitalize(v), 'status', v));
      activeOrgType.forEach(v => addChip(formatOrgType(v), 'orgtype', v));

      $activeCount.textContent = count;
      $activeCount.classList.toggle('hidden', count === 0);
    }

    /* ---- Helpers ---- */
    function esc(str) {
      const d = document.createElement('div');
      d.textContent = str || '';
      return d.innerHTML;
    }

    function capitalize(s) {
      if (!s) return '';
      return s.charAt(0).toUpperCase() + s.slice(1);
    }

    function formatOrgType(t) {
      if (!t || t === '—') return '—';
      return t.split('-').map(capitalize).join(' ');
    }

    function formatDate(d) {
      if (!d) return '';
      const dt = new Date(d + 'T00:00:00');
      return dt.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
    }

    function clearAll() {
      searchQuery = '';
      $search.value = '';
      activeTags.clear();
      activeComplexity.clear();
      activeStatus.clear();
      activeOrgType.clear();
      document.querySelectorAll('.filter-chip--on').forEach(c => {
        c.className = 'filter-chip filter-chip--off';
      });
      render();
    }

    /* ---- Event listeners ---- */
    $search.addEventListener('input', e => {
      searchQuery = e.target.value.trim();
      render();
    });

    $sortSelect.addEventListener('change', e => {
      sortKey = e.target.value;
      render();
    });

    $filterToggle.addEventListener('click', () => {
      $filterPanel.classList.toggle('hidden');
    });

    $clearFilters.addEventListener('click', clearAll);
    $emptyClear.addEventListener('click', clearAll);

    // Keyboard shortcut: "/" to focus search
    document.addEventListener('keydown', e => {
      if (e.key === '/' && document.activeElement !== $search) {
        e.preventDefault();
        $search.focus();
      }
      if (e.key === 'Escape' && document.activeElement === $search) {
        $search.blur();
      }
    });

    /* ---- Go ---- */
    init();
  })();
  </script>

</body>
</html>
